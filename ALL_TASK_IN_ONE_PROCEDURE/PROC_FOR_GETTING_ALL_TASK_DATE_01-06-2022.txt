CREATE OR REPLACE PROCEDURE all_tasks(USER_CHOICE  NUMBER,
VAR_RET OUT SYS_REFCURSOR)
AS
BEGIN
  IF(USER_CHOICE = '1')
  THEN
    DBMS_OUTPUT.put_line('==== FETCH TASK 01 ==== ');
    DBMS_OUTPUT.put_line('==== GET CLASS NAME , DOCUMENT CODE , COUNT OF DOCUMENT CODE ====');
    OPEN VAR_RET FOR SELECT IPC.CLASS_NAME, IA.DOCUMENT_CODE,
    COUNT(IA.DOCUMENT_CODE)
    FROM INS_ASSORTED IA,
    INS_POLICY_CLASS IPC,
    INS_POLICY_TYPES IPT WHERE IA.ENT_DATE BETWEEN TRUNC(TO_DATE('01/05/2022','DD/MM/YYYY'))
    AND TRUNC(TO_DATE('31/05/2022','DD/MM/YYYY')) AND
    IA.DOCUMENT_CODE IN('04','05','06','07') AND
    IPT.POLICY_TYPE_CODE <> 77 AND
    IA.SUP_BY IS NULL AND
    IA.POLICY_TYPE_CODE = IPT.POLICY_TYPE_CODE AND
    IPT.CLASS_CODE = IPC.CLASS_CODE
    GROUP BY IPC.CLASS_NAME,IA.DOCUMENT_CODE;

  ELSIF(USER_CHOICE = '2')
  THEN
    DBMS_OUTPUT.put_line('==== FETCH TASK 02 ==== ');
    DBMS_OUTPUT.put_line('==== NOW MOVE ON SECOND TABLE ====');
    OPEN VAR_RET FOR SELECT IPC.CLASS_NAME, IPT.POLICY_NAME,
    COUNT(IPT.POLICY_TYPE_CODE)
    FROM INS_ASSORTED IA,
    INS_POLICY_TYPES IPT, INS_POLICY_CLASS IPC WHERE
    IA.DOCUMENT_CODE = '04' AND IA.ISSUE_DATE BETWEEN TRUNC(TO_DATE('01/01/2022','DD/MM/YYYY'))
    AND TRUNC(TO_DATE('01/03/2022','DD/MM/YYYY')) AND
    IA.POLICY_TYPE_CODE = IPT.POLICY_TYPE_CODE AND
    IPT.CLASS_CODE = IPC.CLASS_CODE GROUP BY
    IPC.CLASS_NAME, IPT.POLICY_NAME, IPT.POLICY_TYPE_CODE;

  ELSIF(USER_CHOICE = '3')
  THEN
    DBMS_OUTPUT.put_line('== FETCH TASK 03 ====');
    DBMS_OUTPUT.put_line('==== GET POLICY NAME , CLASS NAME WITH CODE ==== ');
    OPEN VAR_RET FOR SELECT IPC.CLASS_CODE,IPC.CLASS_NAME,
    IPT.POLICY_TYPE_CODE, IPT.POLICY_NAME FROM
    INS_POLICY_CLASS IPC, INS_POLICY_TYPES IPT
    WHERE IPC.CLASS_NAME IN(SELECT IPC.CLASS_NAME FROM INS_POLICY_CLASS IPC WHERE
    IPC.CLASS_NAME IN('MISCELLANEOUS','MOTOR','HEALTH')) AND
    IPT.CLASS_CODE = IPC.CLASS_CODE;

  ELSIF(USER_CHOICE = '4')
  THEN
    DBMS_OUTPUT.put_line('== FETCH TASK 04 ====');
    DBMS_OUTPUT.put_line('==== SEE ALL BRANCHES AND RESPECTIVE CODES ==== ');
    OPEN VAR_RET FOR SELECT IPC.CLASS_CODE,IPC.CLASS_NAME,
    IPT.POLICY_TYPE_CODE, IPT.POLICY_NAME,
    B.BRANCH_CODE,
    B.BRANCH_NAME FROM INS_POLICY_CLASS IPC,
    INS_POLICY_TYPES IPT, INS_BRANCH B
    WHERE IPT.CLASS_CODE = IPC.CLASS_CODE AND
    IPC.CLASS_CODE = B.BRANCH_CODE AND
    IPC.CLASS_NAME IN (SELECT IPC.CLASS_NAME FROM INS_POLICY_CLASS IPC
    WHERE IPC.CLASS_NAME IN ('MISCELLANEOUS','MOTOR','HEALTH'));

  ELSIF(USER_CHOICE = '5')
  THEN
    DBMS_OUTPUT.put_line('=== FETCH TASK 05 ==== ');
    DBMS_OUTPUT.put_line('== GETTING RECORD WITH COMPLEX SINARIO ==');
    OPEN VAR_RET FOR
    SELECT IA.DOCUMENT_CODE,COUNT(IA.DOCUMENT_CODE),
    IPC.CLASS_CODE,IPC.CLASS_NAME,IPT.POLICY_TYPE_CODE,
    IPT.POLICY_NAME, B.BRANCH_CODE, B.BRANCH_NAME FROM INS_ASSORTED IA ,
    INS_POLICY_CLASS IPC, INS_POLICY_TYPES IPT,
    INS_BRANCH B
    WHERE IA.DOCUMENT_CODE IN(SELECT IA.DOCUMENT_CODE
    FROM INS_ASSORTED IA
    WHERE IA.DOCUMENT_CODE IN ('04','05','06','07'))
    AND IA.ENT_DATE IN(SELECT IA.ENT_DATE
    FROM INS_ASSORTED IA
    WHERE IA.ENT_DATE BETWEEN TRUNC(TO_DATE('01/01/2021','DD/MM/YYYY')) AND
    TRUNC(TO_DATE('31/05/2022','DD/MM/YYYY')))
    AND
    IPC.CLASS_NAME IN(SELECT IPC.CLASS_NAME
    FROM INS_POLICY_CLASS IPC
    WHERE IPC.CLASS_NAME IN('MISCELLANEOUS','MOTOR','HEALTH')) --AND
    --B.BRANCH_NAME IN(SELECT B.BRANCH_NAME
    --FROM INS_BRANCH B WHERE B.BRANCH_NAME IN ('KARACHI','FAISALABAD','ISLAMABAD','QUETTA'))
    AND
    IA.POLICY_TYPE_CODE = IPT.POLICY_TYPE_CODE AND
    IPT.CLASS_CODE = IPC.CLASS_CODE AND
    IPC.CLASS_CODE = B.BRANCH_CODE
    GROUP BY IA.DOCUMENT_CODE,IPC.CLASS_CODE,IPC.CLASS_NAME,IPT.POLICY_TYPE_CODE,
    IPT.POLICY_NAME, B.BRANCH_CODE, B.BRANCH_NAME;
  ELSIF(USER_CHOICE = '6')
  THEN
    DBMS_OUTPUT.put_line('=== FETCH TASK 06 === ');
    DBMS_OUTPUT.put_line(' === GETTING RECORD WITH MULTIPLE JOINS === ');
    OPEN VAR_RET FOR 
    select ia.assorted_code,ia.agency_code,ia.ent_date
    ,idt.document_code,idt.document_name,
    ipc.class_code, 
    ipc.class_name, b.branch_code,
    b.branch_name from 
    ins_assorted ia ,
    ins_policy_class ipc,
    ins_policy_types ipt,
    ins_branch b,
    ins_document_type idt
    where 
    ia.policy_type_code = ipt.policy_type_code and 
    ipt.class_code = ipc.class_code and 
    ia.document_code = idt.document_code and 
    ia.branch_code = b.branch_code and 
    ia.document_code in(select ia.document_code
    from ins_assorted ia 
    where ia.document_code in('04','05','06')) and 
    ia.ent_date 
    between trunc(to_date('01/05/2022','dd/mm/yyyy')) 
    and trunc(to_date('31/05/2022','dd/mm/yyyy')) 
    and 
    ipt.policy_type_code <> 77 
    and ia.sup_by is null and 
    b.branch_code in 
    (select b.branch_code
    from ins_branch b 
    where b.branch_code in ('01','02','03','04')) and 
    idt.document_name in 
    (select idt.document_name
    from ins_document_type idt 
    where 
    idt.document_name in ('Policy','Endorsement','Open Policy'));
   
  ELSIF(USER_CHOICE = '7')
  THEN
    OPEN VAR_RET FOR
    SELECT IPC.PARTTAKER_CATEGORY, COUNT(IPC.PARTTAKER_CATEGORY)COUNT_CATEGORY
    FROM INS_PARTTAKER IP, INS_PARTTAKER_CATEGORY IPC
    WHERE IP.CATEGORY_PARTTAKER_CODE = IPC.CATEGORY_PARTTAKER_CODE
    AND IP.ACTIVE = 'Y'
    AND IPC.CATEGORY_PARTTAKER_CODE IN ('09', '08', '10', '27', '29', '28')
    GROUP BY IPC.PARTTAKER_CATEGORY, IP.ACTIVE
    UNION ALL
    SELECT IPC.PARTTAKER_CATEGORY, COUNT(IPC.PARTTAKER_CATEGORY) COUNT_CATEGORY
    FROM INS_PARTTAKER IP, INS_PARTTAKER_CATEGORY IPC
    WHERE IP.CATEGORY_PARTTAKER_CODE = IPC.CATEGORY_PARTTAKER_CODE
    AND NVL(IP.ACTIVE, 'Y') = 'Y'
    AND IPC.CATEGORY_PARTTAKER_CODE IN ('30', '31')
    GROUP BY IPC.PARTTAKER_CATEGORY, IP.ACTIVE; 
    
  ELSIF(USER_CHOICE = '8')
  THEN 
    OPEN VAR_RET FOR SELECT IP.PARTTAKER_CODE,
       IP.PARTTAKER_NAME,
       IPC.CATEGORY_PARTTAKER_CODE,
       IPC.PARTTAKER_CATEGORY,
       IPS.SALARY_AMOUNT,
       (IPS.SALARY_AMOUNT*2) AMOUNT ,
       IPD.SALARY_PERIOD_TO - IPD.SALARY_PERIOD_FROM PERIOD
  FROM INS_PARTTAKER             IP,
       INS_PARTTAKER_CATEGORY    IPC,
       INS_PARTTAKER_SALARY      IPS,
       INS_PARTTAKER_SALARY_PAID IPD
 WHERE IP.CATEGORY_PARTTAKER_CODE = IPC.CATEGORY_PARTTAKER_CODE
      --AND IP.PARENT_CODE = IPS.PARTTAKER_CODE
   AND IPS.SALARY_ID = IPD.SALARY_ID
   AND IP.ACTIVE = 'Y'
   AND IPC.CATEGORY_PARTTAKER_CODE IN ('09', '10', '11', '28', '30', '31')
   AND IP.PARTTAKER_NAME IS NOT NULL
 GROUP BY IP.PARTTAKER_CODE,
          IP.PARTTAKER_NAME,
          IPC.CATEGORY_PARTTAKER_CODE,
          IPC.PARTTAKER_CATEGORY,
          IPS.SALARY_AMOUNT, IPD.SALARY_PERIOD_FROM,IPD.SALARY_PERIOD_TO

UNION ALL
SELECT IP.PARTTAKER_CODE,
       IP.PARTTAKER_NAME,
       IPC.CATEGORY_PARTTAKER_CODE,
       IPC.PARTTAKER_CATEGORY,
       IPS.SALARY_AMOUNT,
       (IPS.SALARY_AMOUNT*2) AMOUNT ,
       IPD.SALARY_PERIOD_TO - IPD.SALARY_PERIOD_FROM PERIOD
  FROM INS_PARTTAKER             IP,
       INS_PARTTAKER_CATEGORY    IPC,
       INS_PARTTAKER_SALARY      IPS,
       INS_PARTTAKER_SALARY_PAID IPD
 WHERE IP.CATEGORY_PARTTAKER_CODE = IPC.CATEGORY_PARTTAKER_CODE
      --AND IP.PARENT_CODE = IPS.PARTTAKER_CODE
   AND IPS.SALARY_ID = IPD.SALARY_ID
   AND NVL(IP.ACTIVE, 'Y') = 'Y'
   AND IPC.CATEGORY_PARTTAKER_CODE IN ('30', '31')
   AND IP.PARTTAKER_NAME IS NOT NULL
 GROUP BY IP.PARTTAKER_CODE,
          IP.PARTTAKER_NAME,
          IPC.CATEGORY_PARTTAKER_CODE,
          IPC.PARTTAKER_CATEGORY,
          IPS.SALARY_AMOUNT,IPD.SALARY_PERIOD_FROM,IPD.SALARY_PERIOD_TO;
  ELSE
    DBMS_OUTPUT.PUT_LINE('ERROR OCCUR WHILE EXCECUTING YOUR QUERY');

    END IF;


END;